---
title: "Reflex 사용 후 느낌 점(with 간단한 팁)"
summary: "새로운 풀 스택 python 프레임워크를 약 8개월간 사용해보고 느낀 점과 간단한 팁을 공유합니다."
date: 2024-01-07T23:34:26+09:00
draft: false
tags: ["python", "ASGI"]
showToc: True
---

## 들어가기 전에
이 글은 reflex를 사용한 경험을 공유하고, reflex 사용 시 유의해야 할 점과 팁을 공유합니다. [reflex 프레임워크](https://reflex.dev/)에 관한 지식이 있거나 사용을 고민하고 있다면 좋습니다. 이 프레임워크를 추천하는지 아닌지가 궁금하시다면 결론부터 보시면 되겠습니다.
## Reflex 후기 
### 장점
#### 1. 데이터 통신을 신경쓰지 않아도 됨
Reflex의 최고 장점은 서버와 클라이언트 간 데이터 통신 관리를 신경쓰지 않아도 된다는 점입니다. 처음에는 프론트엔드를 잘 몰라도 웹개발이 가능한 점이 장점이라고 생각했었습니다. 하지만 사용하면 사용할수록 이게 정말 큰 장점입니다. API 스키마를 선언하고, 오류 케이스별로 상태 코드와 응답을 나누고 그에 따른 처리 코드를 클라이언트/서버 양쪽으로 작성할 필요가 없다 보니 코드 양이 굉장히 많이 줄어들고 테스트 코드가 같이 줄어듭니다. 
#### 2. 빠른 개발속도
두번째로, 굉장히 빠르게 개발이 이루어집니다. 사실 첫 번째 장점으로 꼽은 데이터 통신 관리를 신경쓰지 않아도 되는 것은 템플릿 기반으로 HTML을 만드는 방식에게도 적용됩니다. 하지만 템플릿은 IDE의 추적이 안 됩니다. 거기에 더해 템플릿으로 혹은 유사한 매크로로 프로그래밍을 해봤을 분들이라면 다들 공감하실 특유의 난해함과 머리 속에 정확히 잘 그려지지 않는 비직관성 때문에 느립니다. 반면에 reflex는 컴포넌트가 Python 코드로 작성되고 HTML/CSS 요소가 IDE의 추적을 받기 때문에 훨씬 빠르고 쾌적하게 개발할 수 있습니다.
#### 3. 프론트엔드/디자인을 잘 몰라도 됨
세 번째로, 프론트엔드와 디자인을 잘 모르더라도 그럭저럭 괜찮은 결과물을 만들어 낼 수 있습니다. 공식 문서의 튜토리얼, 레퍼런스, 샘플 코드가 잘 작성되어 있어 어렵지 않게 배우고 시작할 수 있습니다. 현재 모든 컴포넌트가 Charka-UI 기반으로 디자인이 잘 되어 있기 때문에 적당히 괜찮은 결과물이 나옵니다. 궁금하다면 [Reflex 공식 문서의 샘플](https://reflex.dev/docs/gallery/)을 참조 바랍니다.

### 단점
Reflex의 큰 단점으로는 퍼포먼스 문제입니다. 간단한 이벤트 처리도 서버를 경유해야 하기 네트워크로 인한 지연시간이 있고, 기본적으로 하나의 React Context로 모든 상태를 관리하기 때문에 하나의 변경에도 애플리케이션 전체의 렌더링이 일어나 눈에 띄게 느려질 수 있습니다. 이는 공식 홈페이지에서 검색창에 입력을 빠르게 지우고 입력하길 반복하면 쉽게 재현할 수 있습니다. 빠르고 쓰고 지우기를 반복하면 화면이 아무런 반응을 하지 않고 멈추며, 천천히 검색 결과창이 바뀌다가 다시 정상으로 돌아옵니다. 의도적으로 만든 상황이기는 하지만 이게 몇 초 정도 지속되는데, 사용자 입장에서 굉장히 불쾌할 수 있습니다.
두 번째로는 
## 권장 Practice

### 1. 입력은 form을 통해서
Input을 State의 변수와 연동해서 입력을 받는 방법이 있지만, 이는 debouncer를 적용한다고 해도 찾은 리렌더링과 늦은 반응속도를 만들어낼 수 있습니다. 위의 공식 사이트 검색 기능이 대표적입니다. 가능하다면 form을 통해 제출 시 한 번에 입력하도록 하는 방법이 좋습니다.
```python
import reflex as rx

class State(rx.State):
	email: str
	phone_number: str

	def handle_submit(self, data: dict):
		...

# Bad
def singin_with_state():
	return rx.box(
		rx.input(placeholder='email', value=State.email),
		rx.input(placeholder='phone_number', value=State.phone_number)
	)

# Good
def signin_with_form():
	return rx.box(
		rx.form(
			rx.input(name='email'),
			rx.input(name='phone_number'),
			rx.button("Submit", type_='submit'),
			on_submit=State.handle_submit
		)
	)

```

### 2. 데이터와 화면 상태 State를 분리
데이터 State와 화면 상태 State를 분리하면 관심사 분리 원칙에 따라 여러 이점이 있습니다. 화면 상태 State의 경우 특정 알림창이 보이는지, 현재 프로세스 처리 진행 상황 등을 말합니다. 기본적으로 둘을 분리함으로써 차후에 애플리케이션이 복잡해지고 팀에 프론트엔드 개발자가 합류한다면 빠르게 프레임워크 전환이 가능한 이점을 얻을 수 있습니다. 그보다 중요한 이유는 주관적인 이유지만, 둘의 코드 성질이 조금 다릅니다. 상태 State의 경우 유즈케이스 시나리오를 따라가기 때문에 좀 더 서술적이고 스크립트에 가깝습니다. 반면에 데이터 State의 경우 외부 데이터베이스 읽기/쓰기 작업과 검증 작업이 주로 포함되고 단순한 경향이 있습니다. 경험적으로 분리하는 것이 효율성에 좀 더 도움 되었던 것 같습니다.
### 3. 템플릿/컴포넌트 함수 최대한 활용하기
컴포넌트를 작성하다보면 탭 수가 굉장히 많이 늘어나기 쉽습니다. 2탭을 기본으로하는 Javasrcript/Typscript와 달리 Python은 4탭이 강제되기 때문에 굉장히 거슬립니다. 컴포넌트 함수를 많이 쓰면 이 문제를 해결할 수 있습니다.
### 4. 기타
1. 락을 유의해야 합니다. 굉장히 기본적인 부분이라 기타에 넣었습니다. background 작업에서는 비동기 컨텍스트 매니저에 진입해야지만 데이터 수정이 가능합니다. 자칫하면 애플리케이션이 멈추는 불상사가 발생할 수도 있다는 점을 유의하면서 조심스럽게 작업해야 합니다.
2. 프로덕션 모드로 배포 시에 컴파일이 꽤 오래 걸리고 자원을 꽤 많이 잡아먹습니다. 빌드가 필요한 언어를 사용하시는 분이라면 당연할 수 있지만, python은 그렇지 않기에 추가했습니다. 따로 빌드 머신을 쓴다면 넉넉히 8gb 이상 램을 주시는 것이 좋을 것 같습니다.

### 결론 - 그래서 쓸만한가요?
저는 꽤 오래 Reflex를 개인적으로 써왔습니다. 사실 프레임워크 자체가 아직 정식 출시 전인 굉장히 초기 프로젝트 이기도 하고, 사용자가 좀 되는 프로덕션용으로 써본 것은 아니라서 말하기 조심스럽습니다. 웹 프론트엔드를 잘 모르면서 작업해야 하는 경우, 내부 서비스용으로 작업해야 하는 경우 굉장히 추천할 만하다고 생각합니다. 특히 템플릿을 사용을 고민하고 계시다면 reflex를 한 번 고민하는 것을 적극 권장드립니다.
